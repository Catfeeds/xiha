<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/html5.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/respond.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__PUBLIC__/Admin/assets/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Admin/assets/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Admin/assets/lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Admin/assets/css/style.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Admin/assets/lib/Hui-iconfont/1.0.6/iconfont.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/Admin/assets/lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>添加学员</title>
</head>
<body>
<div class="pd-20">
    <form action="{: U('Student/addStudent')}" enctype="multipart/form-data" method="post" onSubmit="return formcheck();" class="form form-horizontal" id="addStudent">
        <!-- <div class="row cl">
            <label class="form-label col-2"><span class="c-red"></span>昵称：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value="" placeholder="请填写学员昵称" id="" name="user_name">
            </div>
        </div> -->
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>真实姓名：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value="" datatype="*1-64" nullmsg="真实姓名不能为空" placeholder="请填写学员的真实姓名" id="real_name" name="real_name">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>手机号码：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value=""  datatype="*1-32" nullmsg="手机号码不能为空" placeholder="请填写学员手机号码" id="user_phone" name="user_phone">
                <span id="phone-tips" style="color:red;"></span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>学员年龄：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value="" datatype="*1-32" nullmsg="学员年龄不能为空" placeholder="请填写学员年龄" id="age" name="age">
                <span id="age-tips" style="color:red;"></span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>身份证：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value="" placeholder="请填写身份证号" id="identity_id" name="identity_id" datatype="*1-64" nullmsg="身份证不能为空">
                <span id="identity-tips" style="color:red;"></span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2">领证次数：</label>
            <div class="formControls col-3">
                <!-- <input type="text" class="input-text" value=""  placeholder="请填写学员领证次数" id="license_num" name="license_num"> -->
                <input type="button" value="-" onclick="sub(this)" class="btn btn-success" style="border-radius:3px;" >
                <input type="input-text"  value="0" name="license_num" style="width:200px;height:26px;text-align:center;border-radius:3px;" >
                <input type="button" value="+" onclick="add(this)" class="btn btn-success" style="border-radius:3px;" > 次
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>牌照：</label>
            <div class="formControls col-3">
                <select class="select" name="license_id" id="license_id" style="height:30px;" datatype="*1-32" nullmsg="牌照不能为空">
                    <option value="">请选择牌照</option>
                    <foreach name="licenseinfo" item="value">
                        <option value="{$value.license_id}">{$value.license_name}</option>
                    </foreach>
                </select> 
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>科目：</label>
            <div class="formControls col-3">
                <select class="select" name="lesson_id" id="lesson_id" style="height:30px;" datatype="*1-32" nullmsg="科目不能为空">
                    <option value="">请选择科目</option>
                    <foreach name="lessoninfo" item="value">
                        <option value="{$value.lesson_id}">{$value.lesson_name}</option>
                    </foreach>
                </select> 
            </div>
        </div>
        <!-- <div class="row cl">
            <label class="form-label col-2">学员来源：</label>
            <div class="formControls col-3">
                <select class="select" name="i_from" id="i_from" style="height:30px;">
                    <option value="0">苹果</option>
                    <option value="1">安卓</option>
                    <option value="2" selected>线下</option>
                </select> 
            </div>
        </div> -->
        <!-- <div class="row cl">
            <label class="form-label col-2">学车状态：</label>
            <div class="formControls col-3">
                <select class="select" name="learncar_status" id="learncar_status" style="height:30px;">
                    <option value="">请选择学车状态</option>
                    <option value="科目一学习中">科目一学习中</option>
                    <option value="科目二学习中">科目二学习中</option>
                    <option value="科目三学习中">科目三学习中</option>
                    <option value="科目四学习中">科目四学习中</option>
                    <option value="已领证">已领证</option>
                </select> 
            </div>
        </div> -->
        <div class="row cl">
            <label class="form-label col-2" for="address"><span class="c-red">*</span>地址：</label>
            <div class="formControls col-1" >
                <select class="select" name="province" datatype="*1-32" nullmsg="省份不能为空" id="province" style="height:30px;">
                    <option value="">请选择省份</option>
                    <foreach name="province_list" item="pro">
                        <option value="{$pro.provinceid}">{$pro.province}</option>
                    </foreach>
                </select>
            </div>             
            <div class="formControls col-1">  
                <select class="select" name="city" datatype="*1-32" nullmsg="城市不能为空" id="city" style="height:30px;">
                    <option value="">请选择城市</option>           
                </select>
            </div>
           <div class="formControls col-1">
                <select class="select" name="area" datatype="*1-32" nullmsg="区域不能为空" id="area" style="height:30px;">
                    <option value="">请选择区域</option>
                </select> 
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-2"><span class="c-red">*</span>详细地址：</label>
            <div class="formControls col-3">
                <input type="text" class="input-text" value="" datatype="*1-64" nullmsg="详细地址不能为空" placeholder="请填写详细地址" id="address" name="address">
            </div>
        </div>
        
        <div class="row cl">
            <label class="form-label col-2">性别：</label>
            <div class="formControls col-3 btn-group">
                <label class="btn radius btn-success radio sex"><input name="sex" value="1" type="radio" checked style="display:none;">男</label>
                <label class="btn radius btn-primary-outline radio sex"><input name="sex" value="2" type="radio" style="display:none;">女</label>
            </div>
        </div>
        <!-- <div class="row cl">
            <label class="form-label col-2 pd-15">学员头像：</label>
            <div class="formControls col-5 pd-15">
                <input type="file" name="user_photo" />
                <p class="c-warning ">
                    图片不要超过100KB, 单张图片标准尺寸为 100*100px  
                </p>
            </div>
            <div class="formControls col-2 pd-15">
                <span class="Hui-iconfont" id="photo-choose" style="color:red;">&#xe61f;</span>
                <p class="c-warning ">
                    如果没有图片可上传，也可以点击上方选择默认头像
                </p>
                <input type="hidden" name="photo_id" value="" id="photo_id">
            </div>
        </div> -->
        <div class="row cl">
            <div class="col-10 col-offset-2">
                <button class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存并提交审核</button>
                <button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/layer/2.1/layer.js"></script>
<!-- <script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/My97DatePicker/WdatePicker.js"></script>  -->
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/Validform/5.3.2/Validform.min.js"></script> 
<!-- <script type="text/javascript" src="__PUBLIC__/Admin/assets/lib/webuploader/0.1.5/webuploader.min.js"></script>  -->
<script type="text/javascript" src="__PUBLIC__/Admin/assets/js/H-ui.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/assets/js/H-ui.admin.js"></script> 
<script type="text/javascript" src="__PUBLIC__/Admin/assets/js/json2.min.js"></script> 
<script type="text/javascript">
// 数目的增加
function sub(obj){
    var temp=parseInt(obj.nextElementSibling.value);
    if(temp>0){
        temp--;
        obj.nextElementSibling.value=temp;
    }
}
function add(obj){
    var temp=parseInt(obj.previousElementSibling.value);
    temp++;
    obj.previousElementSibling.value=temp;
}
// 表单验证
$( function () {
    $('#addStudent').Validform({
            tiptype:2,
            callback:function(form){
                form[0].submit();
            }
    });
}) 

/*
* 性别
* 点击切换效果
*/
$('.btn-group .sex input').click(function() {
    var current = $(this).parent();
    var siblings = $(this).parent().siblings();
    current.removeClass("btn-primary-outline").addClass("btn-success");
    siblings.removeClass("btn-success").addClass("btn-primary-outline");
});
//城市联动
$('#province').blur(function() {
   var province_id = $(this).val();
   $('#city').load("__URL__/getCity/province_id/"+province_id);
});
$('#city').blur(function() {
    var city_id = $(this).val();
    $('#area').load("__URL__/getArea/city_id/"+city_id);
    var city_html = $(this).find('option:selected').html();
    var province_html = $('#province').find('option:selected').html();
    $('#address').val(province_html+city_html);
});
$('#area').blur(function() {
    var city_html = $('#city').find('option:selected').html();
    var province_html = $('#province').find('option:selected').html();
    var area_html = $(this).find('option:selected').html();
    $('#address').val(province_html+city_html+area_html);
});


/*检测学员手机号*/
  $('#user_phone').blur(function() {
      var user_phone = $('#user_phone').val();
      if(user_phone.trim() == '') {
          layer.msg('请填写手机号!',{icon: 6});
          return false;
      } 
      if (!parseInt(user_phone)) {
          layer.msg('请填写正确格式!',{icon: 6});
          return false;
      } else if(!phonevalidate(user_phone)) {
          layer.msg('请填写正确格式!',{icon: 6});
          return false;
      }
      $.ajax({
          type:"POST",
          url:"__URL__/checkPhone",
          data:{'so_phone':user_phone},
          dataType:"JSON",
          beforeSend:function() {
            $('#phone-tips').text('☛ 检测中... ...');
          },
          success:function(data) {
              $('#phone-tips').html(data.msg);
          }
      })
  });

  //检测学员年龄，必须满18岁
  $('#age').blur(function() {
    var age = $('#age').val();
    if (age.trim() == '') {
      layer.msg('请填写年龄',{icon: 6});
      return false;
    }
    if (!parseInt(age)) {
          layer.msg('请填写正确格式',{icon: 6});
          return false;
    }
    if (age < 18) {
        layer.msg('年龄不能小于18周岁', {icon: 6});
        return false;
    }
    if (age > 70) {
        layer.msg('年龄不能大于70周岁', {icon: 6});
        return false;
    }

  });

  /*检测学员身份证*/
  $('#identity_id').blur(function() {
      var identity_id = $('#identity_id').val();
      if(identity_id.trim() == '') {
          layer.msg('请填写身份证!',{icon: 6});
          return false;
      } 
      $.ajax({
          type:"POST",
          url:"__URL__/checkIdentity",
          data:{'identity_id':identity_id},
          dataType:"JSON",
          beforeSend:function() {
            $('#identity-tips').text('☛ 检测中... ...');
          },
          success:function(data) {
              $('#identity-tips').html(data.msg);
          }
      })
    });
// 手机号验证
  function phonevalidate(phone) {
    var reg = /^0?1[3|4|5|8|7|9][0-9]\d{8}$/;
    if(!reg.test(phone)) {
      return false;
    } else {
      return true;
    }
  }
  //提交表单前检测表单数据
  // function formcheck() {
  //     var address = $('#address').val();
  //     var user_phone = $('#user_phone').val();
  //     var real_name = $('#real_name').val();
  //     var identity_id = $('#identity_id').val();
  //     var province = $('#province').val();
  //     // var order_no = $('#order_no').val();
  //     var city = $('#city').val();
  //     var area = $('#area').val();
  //     var age = $('#age').val();
  //     // var so_original_price = $('#so_original_price').val();
  //     // var so_finale_price = $('#so_finale_price').val();
  //     if(address.trim() == '') {
  //         layer.msg('请填写地址!', {offset: 0,time:3000,shift: 2 });
  //         return false;
  //     }
  //     if(user_phone.trim() == '') {
  //         layer.msg('请填写手机号!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if(real_name.trim() == '') {
  //         layer.msg('请填写真实姓名!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if(identity_id.trim() == '') {
  //         layer.msg('请填写身份证!', {offset: 0,time:3000,shift: 2 });
  //         return false;
  //     }
  //     if(province.trim() == '') {
  //         layer.msg('请选择省份!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if(city.trim() == '') {
  //         layer.msg('请选择城市!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if(area.trim() == '') {
  //         layer.msg('请选择区域!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if(age.trim() == '') {
  //         layer.msg('请填写年龄!', {offset: 0,time:3000,shift: 2});
  //         return false;
  //     }
  //     if (user_phone) {
  //         var check = checkphone(user_phone);
  //         var data = JSON.parse(check);
  //         if(data.code != 200) {
  //           layer.msg(data.msg,{offset: 0,time:3000,shift: 2});
  //           return false;
  //         }
  //     }

  //     if (identity_id) {
  //       var check = checkidentity(identity_id);
  //       var data = JSON.parse(check);  //parse用于从一个字符串中解析出json对象
  //       if(data.code != 200) {
  //         layer.msg(data.msg,{offset: 0,time:3000,shift: 2});
  //         return false;
  //       }
  //     }

  //     if (age) {
  //       var check = checkage(age);
  //       var data = JSON.parse(check);  //parse用于从一个字符串中解析出json对象
  //       if(data.code != 200) {
  //         layer.msg(data.msg,{offset: 0,time:3000,shift: 2});
  //         return false;
  //       }
  //     }
  // }
  function checkphone(user_phone) {
      var res = '';
      $.ajax({
          type:"POST",
          url:"__URL__/checkPhone",
          data:{'so_phone':user_phone},
          dataType:"JSON",
          async:false,
          success:function(data) {
            res = JSON.stringify(data); //stringify()用于从一个对象解析出字符串
          },
          error:function() {
            res = '';
          }
      });
      return res;
  }

  function checkidentity(identity_id) {
      var res = '';
      $.ajax({
          type:"POST",
          url:"__URL__/checkIdentity",
          data:{'identity_id':identity_id},
          dataType:"JSON",
          async:false,
          success:function(data) {
            res = JSON.stringify(data);
          },
          error:function() {
            res = '';
          }
      });
      return res;
  }

  function checkage(age) {
      var res = '';
      $.ajax({
          type:"POST",
          url:"__URL__/checkAge",
          data:{'age':age},
          dataType:"JSON",
          async:false,
          success:function(data) {
            res = JSON.stringify(data);
          },
          error:function() {
            res = '';
          }
      });
      return res;
  }
  // 选择默认头像
  $('#photo-choose').click(function() {
      layer.open({
        type: 2,
        area: ['700px', '530px'],
        fix: false, //不固定
        maxmin: true,
        content: '__URL__/getDefaultPhoto'
      });
  });
</script>
</body>
</html>
